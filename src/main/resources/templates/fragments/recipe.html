<!DOCTYPE html>
<html lang="en" xmlns:th="https://www.thymeleaf.org">

<body>
<div th:fragment="recipeCards(recipes)" class="row row-cols-1 row-cols-sm-2 row-cols-md-4 g-3 g-md-3 mt-1">
    <div th:each="recipe : ${recipes}" th:insert="~{:: recipeCard(recipe)}"></div>
</div>

<div th:fragment="recipeCard(recipe)" class="col">
    <div class="card recipe-card"
         th:style="'background-image: url(/images/Examples/' + ${recipe.image.imageName} + ');'">

        <a th:href="@{/recipe/detail/{recipeId}(recipeId = ${recipe.recipeId})}" class="stretched-link"></a>

        <div class="overlay-text">
            <div class="card-footer">
                <div class="card-time-group">
                    <div class="icon-bg-card text-center">
                        <i class="bi-clock-fill icon-img card-icon-img"></i>
                    </div>
                    <span class="card-text-time" th:text="${recipe.totalCookingTime} + ' mins'"></span>
                </div>
            </div>
            <div class="card-header-title">
                <span class="card-title" th:text="${recipe.title}"></span>
            </div>
        </div>
    </div>
</div>

<!--Detail Page-->

<div th:fragment="recipeDetailImage" class="image-wrapper">
    <div>
        <img class="rounded recipe-image" th:src="'/images/Examples/' + ${recipe.image.getImageName()}">
    </div>
</div>

<div th:fragment="recipeDetailIngredientBox" class="rounded ingredients-box">
    <h3 style="font-weight: bolder; margin-bottom: 1.5rem">Ingredients</h3>
    <div th:each="ingredientRecipe : ${allIngredientRecipes}" class="ingredient-line-container">
        <label th:for="'ingredient-' + ${ingredientRecipe.ingredientRecipeId}"
               style="display: flex; align-items: center; cursor: pointer;">
            <input type="checkbox"
                   th:id="'ingredient-' + ${ingredientRecipe.ingredientRecipeId}"
                   style="margin-right: 8px;">
            <span class="ingredient-line" th:text="${ingredientRecipe}"></span>
        </label>
    </div>
    <div style="margin-bottom: 1rem"></div>
</div>

<div th:fragment="recipeDetailBox" class="rounded recipe-detail-box">
    <div class="three-column-layout" style="padding: 0 60px; margin-block-end: 0">

        <div class="two-column-layout" style="gap: 8px; grid-template-columns: 1fr 2fr; text-wrap: nowrap">
            <div class="icon-bg text-center">
                <i class="bi bi-globe icon-img"></i>
            </div>
            <div>
                <p style="margin-bottom: 0">
                    Cuisine
                </p>
                <p class="header-bolder-accent">
                    French
                </p>
            </div>
        </div>

        <div class="two-column-layout" style="gap: 8px; grid-template-columns: 1fr 2fr">
            <div class="icon-bg text-center">
                <i class="bi-person-fill icon-img"></i>
            </div>
            <div>
                <p style="margin-bottom: 0">
                    Servings
                </p>
                <p class="header-bolder-accent text-nowrap">
                    4 People
                </p>
            </div>
        </div>

        <div class="two-column-layout" style="gap: 8px; grid-template-columns: 1fr 2fr;">
            <div class="icon-bg text-center">
                <i class="bi-clock-fill icon-img"></i>
            </div>
            <div>
                <p class="text-nowrap" style="margin-bottom: 0">
                    Cook Time
                </p>
                <p class="header-bolder-accent text-nowrap">
                    160 Minutes
                </p>
            </div>
        </div>
    </div>

    <h2 class="text-center" style="color: #883531; text-transform: uppercase; font-weight: bolder" th:text="*{recipe.title}"></h2>
    <p class="text-center" style="margin-bottom: 5px" th:text="*{recipe.summary}"></p>
    <a class="text-center" style="margin-bottom: 1rem">More about <i class="bi bi-caret-down-fill"></i></a>
    <p class="text-center align-bottom">Uploaded by username</p>
</div>

<div th:fragment="recipeDetailInstructionsBox">
    <h2 class="instructions-box rounded"
        style="font-weight: bolder">Instructions</h2>
    <div class="step-box rounded" th:each="instruction, iterStat  : ${allInstructions}">
        <div>
            <h3 style="font-weight: bolder; color: black" th:text="'Step ' + ${iterStat.index + 1}"></h3>
            <p th:text="${instruction.description}"></p>
        </div>

        <img style="height: 250px" th:src="'/images/Examples/' + ${instruction.image.getImageName()}" alt="step image">
    </div>
</div>

<div th:fragment="recipeDetailDescriptionBox">
    <div class="rounded recipe-detail-box">
        <h2 style="font-weight: bolder">Description</h2>
        <p th:text="*{recipe.description}"></p>
    </div>
</div>

<!--Form-->

<div th:fragment="recipeForm(formRecipe, allIngredientRecipes, #fields)">
    <form class="row g-3" th:action="@{/recipe/save}" method="post" th:object="${formRecipe}">
        <input type="hidden" th:field="*{recipeId}">
        <div class="row g-3 align-items-center">
            <div class="col-5">
                <label for="title" class="col-form-label">Title</label>
            </div>
            <div class="col-7">
                <input type="text" id="title" class="form-control" aria-describedby="titleHelpInline" th:field="*{title}">
            </div>
            <div class="col-12">
                    <span id="titleHelpInline" class="form-text" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">
                    </span>
            </div>
        </div>
        <div class="row g-3 align-items-center">
            <div class="col-5">
                <label for="description" class="col-form-label">Description</label>
            </div>
            <div class="col-7">
                <textarea id="description" class="form-control" aria-describedby="descriptionHelpInline" th:field="*{description}"></textarea>
            </div>
            <div class="col-12">
                    <span id="descriptionHelpInline" class="form-text" th:if="${#fields.hasErrors('description')}" th:errors="*{description}">
                    </span>
            </div>
        </div>
        <button type="reset" class="btn btn-warning btn-sm text-black">Clear</button>
        <button type="submit" class="btn btn-primary btn-sm text-black">Save recipe</button>
    </form>
</div>

<div th:fragment="recipeFormModal(formRecipe, allIngredientRecipes, #fields)"
                 class="modal fade" id="editForm"
                 tabindex="-1"
                 aria-labelledby="editFormModalLabel"
                 aria-hidden="true">

    <div class="modal-dialog">
        <div class="modal-content">
            <h1 class="modal-title text-center" id="editFormModalLabel">Recipe edit form</h1>
            <div class="modal-body">
                <div class="container-fluid">
                    <div th:replace="~{:: recipeForm(${formRecipe}, ${allIngredientRecipes}, ${#fields})}"></div>
                </div>
            </div>
        </div>
    </div>

    <script th:unless="${formModalHidden}">
        new bootstrap.Modal(document.getElementById('editForm'), {}).toggle()
    </script>
</div>
</body>
</html>